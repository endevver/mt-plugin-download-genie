name:           Download Genie Plugin
version:        1.0.1
id:             downloadgenie
key:            DownloadGenie
description:    A genie that grants you a download
author_name:    "Jay Allen, Endevver LLC"
author_link:    http://endevver.com/about/
plugin_link:    http://endevver.com/download-genie/
doc_link:       http://endevver.com/download-genie/docs
schema_version: 1


config_settings:
    StreamedFileBufferSize:
        default: 8192
    DownloaderScript:
        default: download.cgi

blog_config_template: config_template.mtml

settings:
    track_download_stats:
        default: 0
        scope: blog

applications:
    cms:
        methods:
            asset_stats:         $DownloadGenie::DownloadGenie::CMS::asset_stats
            author_asset_stats:  $DownloadGenie::DownloadGenie::CMS::author_asset_stats
            export_stats:        $DownloadGenie::DownloadGenie::Export::export
            object_export_stats: $DownloadGenie::DownloadGenie::Export::selected_object_export
    downloader:
        handler: MT::App::Downloader
        methods:
            dispatch: $DownloadGenie::MT::App::Downloader::dispatch
tags:
    function:
        AssetDownloadURL:
            handler: $DownloadGenie::DownloadGenie::Tags::hdlr_asset_download_url

callbacks:
    dlg_protected_asset_filter:
        code:       $DownloadGenie::DownloadGenie::Handler::Protection::is_public
        priority:   11
    dlg_authorization_filter:
        code:       $DownloadGenie::DownloadGenie::Handler::Authorization::is_authorized
        priority:   11
    dlg_download_handler:
        code:       $DownloadGenie::DownloadGenie::Handler::Download::handler
        priority:   11

object_types:
    dg_stats: 'DownloadGenie::Stats'

page_actions:
    asset:
        asset_stats:
            label:      'View asset download statistics'
            permission: administer
            mode:       asset_stats
            condition:  $DownloadGenie::DownloadGenie::CMS::page_actions_condition
    list_asset:
        asset_stats:
            label:      'View asset download statistics'
            permission: administer
            mode:       asset_stats
            condition:  $DownloadGenie::DownloadGenie::CMS::page_actions_condition
    author:
        asset_stats:
            label:      'View asset download statistics'
            permission: administer
            mode:       author_asset_stats
            condition:  $DownloadGenie::DownloadGenie::CMS::page_actions_condition
